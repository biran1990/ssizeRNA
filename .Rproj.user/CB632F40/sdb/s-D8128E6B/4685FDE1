{
    "contents" : "%\\VignetteIndexEntry{Sample Size Calculation for RNA-Seq Experimental Design}\n%\\VignettePackage{ssizeRNA}\n%\\VignetteEngine{knitr::knitr}\n\n% To compile this document\n% library('knitr'); rm(list=ls()); knit('ssizeRNA.Rnw')\n\n\\documentclass[12pt]{article}\n\n<<knitr, echo=FALSE, results=\"hide\">>=\nlibrary(\"knitr\")\nopts_chunk$set(\n  tidy=FALSE,\n  message=FALSE)\n@ \n\n<<style-knitr, eval=TRUE, echo=FALSE, results=\"asis\">>=\n    BiocStyle::latex()\n@\n\n<<loadpackage, echo=FALSE>>=\nlibrary(Biobase)\nlibrary(edgeR)\n@\n\n\\renewcommand{\\baselinestretch}{1.2}\n\n\n\\author{Ran Bi, Peng Liu \\\\[1em] \n  \\small{Department of Statistics, Iowa State Univeresity} }\n\n\\title{Sample Size Calculation for RNA-Seq Experimental Design \\\\\n       -- the ssizeRNA package}\n\n\\begin{document}\n\n\\maketitle\n\n\\begin{abstract}\nSample size calculation is a crucial issue when designing an RNA-seq experiment.\nThis vignette explains the use of the package ssizeRNA, which is designed to\nprovide an estimation of sample size while controlling false discovery rate \n(FDR) for RNA-seq experimental design. \n\n\\vspace{1em}\n\n\\textbf{ssizeRNA version:} \\Sexpr{packageVersion(\"ssizeRNA\")}\n\\end{abstract}\n\n\\tableofcontents\n\n\\newpage\n\n\\section{Introduction}\n\nRNA-seq technologies have been popularly applied in transcriptomic studies. \nIn the statistical analysis of RNA-seq data, identifying differentially \nexpressed (DE) genes across treatments or conditions is a major step or\nmain focus. Many statistical methods have been proposed for the detection \nof DE genes with RNA-seq data, such as \\emph{edgeR} \n\\cite{Robinson-McCarthy-Smyth2010}, \\emph{DESeq} \\cite{Anders-Huber2010}, \n\\emph{DESeq2} \\cite{Love-Anders-Huber2014} and \n\\emph{QuasiSeq} \\cite{Lund-Nettleton-McCarthy2012}. \n\nDue to the genetic complexity, RNA-seq experiments are rather costly. Many \nexperiments only employ a small number of replicates, which may lead to \nunreliable statistical inference. Thus, one of the principal questions in \ndesigning an RNA-seq experiment is: how large of the sample size do we need?\n\nMany of the current sample size calculation methods are simulation based, which\nare quite time-consuming. We propose a much less computationally intensive \nmethod and R package \\emph{ssizeRNA} for sample size calculation in designing \nRNA-seq experiments \\cite{Bi-Liu2016}.\n\n\n\\section{Using {\\tt ssizeRNA}}\n\nWe first load the \\emph{ssizeRNA} package.\n<<>>=\nlibrary(ssizeRNA)\n@\n\nTo determine the sample size for an RNA-seq experiment, \nusers need to specify the following parameters:\n\\begin{itemize}\n\\item $G$: total number of genes for testing; \n\\item $pi0$: proportion of non-DE genes; \n\\item $fdr$: FDR level to control; \n\\item $power$: desired average power to achieve; \n\\item $mu$: average read count for each gene in control group \n(without loss of generality, we assume that the normalization \nfactors are equal to 1 for all samples);\n\\item $disp$: dispersion parameter for each gene; \n\\item $logfc$: log fold change for each gene. \n\\end{itemize}\nWe will give several examples of using \\emph{ssizeRNA} sample size \nestimation as follows.\n\n\\subsection{Sample size calculation for a single set of parameter}\n\nHere we consider the situation of single set of parameter, i.e. all genes \nshare the same set of average read count in control group, dispersion parameter,\nand log fold change.\n\nFor example, if we are estimating the sample size for an RNA-seq experiment with\n\\begin{itemize}\n\\item Total number of genes: $G = 10000$;\n\\item Proportion of non-DE genes: $pi0 = 0.8$; \n\\item FDR level to control: $fdr = 0.05$; \n\\item Desired average power to achieve: $power = 0.8$; \n\\item Average read count for each gene in control group: $mu = 10$;\n\\item Dispersion parameter for each gene: $disp = 0.1$;\n\\item Log fold change for each gene: $logfc = log(2)$. \n\\end{itemize}\n\nThe estimated sample size is 14 with anticipated power 0.84 by \n\\emph{ssizeRNA\\_single} function. The function also gives the power vs. \nsample size curve estimated by our method.\n<<sim1_size, fig.height=4.5, fig.width=6>>=\nset.seed(2016)\nsize1 <- ssizeRNA_single(nGenes = 10000, pi0 = 0.8, m = 200, mu = 10, \n                         disp = 0.1, logfc = log(2), fdr = 0.05, \n                         power = 0.8, maxN = 20)\nsize1$ssize\n@\n\nTo check whether desired power would be achieved at the calculated sample \nsize 14 for voom and limma pipeline \\cite{Law-Chen-Shi2014, Smyth2004}, \nwe could use the \\emph{check.power} function, which gives the observed \npower and true FDR by Benjamini and Hochberg's method \n\\cite{Benjamini-Hochberg1995} and Storey's q-value procedure \n\\cite {Storey-Taylor-Siegmund2004} respectively. The results below are \nbased on 10 simulations, indicating that desired power is achieved \nand FDR is controlled successfully.\n<<sim1_power>>=\ncheck.power(m = 14, mu = 10, disp = 0.1, logfc = log(2), sims = 10)\n@\n\n\\subsection{Sample size calculation for gene-specific mean and dispersion\nwith fixed log fold change}\n\nNow we will give an example of sample size calculation for gene-specific mean \nand dispersion. Here we use the real RNA-seq dataset from Hammer, P. et al.,\n2010 \\cite{Hammer-Banck-Amberg2010} to generate gene-specific mean and \ndispersion parameters. \n<<sim2_para>>=\ndata(hammer.eset)\ncounts <- exprs(hammer.eset)[, phenoData(hammer.eset)$Time == \"2 weeks\"]\ncounts <- counts[rowSums(counts) > 0,]  ## filter zero count genes\ntrt <- hammer.eset$protocol[which(hammer.eset$Time == \"2 weeks\")] \n\n## average read count in control group for each gene\nmu <- apply(counts[, trt == \"control\"], 1, mean)\n\n## dispersion for each gene\nd <- DGEList(counts)\nd <- calcNormFactors(d)\nd <- estimateCommonDisp(d)\nd <- estimateTagwiseDisp(d)\ndisp <- d$tagwise.dispersion\n@\n\nIf we would like to estimate the sample size for the above RNA-seq experiment \nwith\n\\begin{itemize}\n\\item Total number of genes: $G = 10000$;\n\\item Proportion of non-DE genes: $pi0 = 0.8$; \n\\item FDR level to control: $fdr = 0.05$; \n\\item Desired average power to achieve: $power = 0.8$; \n\\item Log fold change for each gene: $logfc = log(2)$. \n\\end{itemize}\n\nThe estimated sample size is 8 with anticipated power 0.81 by \n\\emph{ssizeRNA\\_vary} function. The function also gives the power vs. \nsample size curve estimated by our method.\n<<sim2_size, fig.height=4.5, fig.width=6>>=\nset.seed(2016)\nsize2 <- ssizeRNA_vary(nGenes = 10000, pi0 = 0.8, m = 200, mu = mu, \n                       disp = disp, logfc = log(2), fdr = 0.05, \n                       power = 0.8, maxN = 15, replace = FALSE)\nsize2$ssize\n@\n\nThe observed power and true FDR by Benjamini and Hochberg's method and \nStorey's q-value procedure could also be checked by the \\emph{check.power} \nfunction.\n\n\\subsection{Sample size calculation for gene-specific mean and dispersion\nwith different log fold change}\n\nIf not all genes share the same log fold change, for example, if log fold \nchange comes from a normal distribution, \n$$logfc \\sim Normal(log(2), 0.5*log(2))$$\nother parameters remain the same as in subsection 2.2, then the estimated \nsample size is 14 with anticipated power 0.80 by \\emph{ssizeRNA\\_vary} \nfunction.\n<<sim3_size, fig.height=4.5, fig.width=6>>=\nset.seed(2016)\nlogfc <- function(x){rnorm(x, log(2), 0.5*log(2))}\nsize3 <- ssizeRNA_vary(nGenes = 10000, pi0 = 0.8, m = 200, mu = mu, \n                       disp = disp, logfc = logfc, fdr = 0.05, \n                       power = 0.8, maxN = 20, replace = FALSE)\nsize3$ssize\n@\n\nBy the following command, we verified that the desired power 0.8 is achieved\nat the calculated sample size 14 for voom and limma pipeline. \n<<sim3_power>>=\ncheck.power(m = 14, mu = mu, disp = disp, logfc = logfc, sims = 10, \n            replace = FALSE)\n@\n\n\n\\section{Conclusion}\n\n\\emph{ssizeRNA} provides a quick calculation for sample size, and an accurate \nestimate of power. Examples in section 2 demonstrate that our proposed method\noffers a reliable approach for sample size calculation for RNA-seq experiments.\n\n\n\\section{Session Info}\n<<echo=TRUE, result=TRUE>>=\nsessionInfo()\n@\n\n\\bibliography{ssizeRNA_ref}\n\n\\end{document}",
    "created" : 1454921123248.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "734399713",
    "id" : "4685FDE1",
    "lastKnownWriteTime" : 1455070259,
    "path" : "~/Documents/ISU/Publication/ssize_rna/ver1.2.1/ssizeRNA/vignettes/ssizeRNA.Rnw",
    "project_path" : "vignettes/ssizeRNA.Rnw",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "sweave"
}